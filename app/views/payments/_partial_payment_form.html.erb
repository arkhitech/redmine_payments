<%= javascript_include_tag 'bootstrap', :plugin => 'redmine_payments' %>
<%= stylesheet_link_tag 'bootstrap',:plugin => 'redmine_payments' %>
<%= stylesheet_link_tag 'bootstrap-theme',:plugin => 'redmine_payments' %>
<!-- Button trigger modal -->
<div id="heading">
  <h2 id="left_title">Make Payment</h2>
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
  Share
</button>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
       <h3 class="modal-title">Shareable Link</h3>
       <br>
      </div>
      <div class="modal-body">
        <p id="pay_url"><%= shared_invoice_payments_url(@token) %></p>
      </div>
      <div class="modal-footer">
        <%= button_to "Reset URL",generate_invoice_payment_token_project_payments_path(@invoice), remote: true %>
      </div>
    </div>
  </div>
</div>
<br>
<%= error_messages_for @payment%>
<%= labelled_form_for @payment, url: register_project_payments_path(@payment.project), html: {method: :post} do |f| %>
  <div class="box tabular">
    <%= f.hidden_field :project_id %>
    <%= f.hidden_field :invoice_id %>
    <p><%= f.text_field :invoice_amount %> Remaining Balance: <%= @payment.remaining_balance_to_s%></p> 
    <p><%= f.text_field :payment_amount %></p>
  </div>
  <p class="buttons">
    <%= f.button l(:make_payment)%>
  </p>
<%end%>
<% OpenExchangeRates.configuration.app_id = Setting.plugin_redmine_payments['open_exchange_rate_app_id']%>
<%= javascript_include_tag 'money', plugin: 'redmine_payments' %>
<%= moneyjs_currency_rates %>
  <script>
    $(document).ready(function() {
      $('#payment_invoice_amount').change(function() {
        var result = fx.convert($(this).val(), {from: '<%=Setting.plugin_redmine_payments['invoice_currency']%>', to: '<%=Setting.plugin_redmine_payments['payment_currency']%>'});
        result = parseFloat(Math.round(result * 100) / 100).toFixed(2);
        $('#payment_payment_amount').val(result);
      });
      $('#payment_payment_amount').change(function() {
        var result = fx.convert($(this).val(), {from: '<%=Setting.plugin_redmine_payments['payment_currency']%>', to: '<%=Setting.plugin_redmine_payments['invoice_currency']%>'});
        result = parseFloat(Math.round(result * 100) / 100).toFixed(2);
        $('#payment_invoice_amount').val(result);
      });
    })
  </script>
