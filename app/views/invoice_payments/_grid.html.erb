<% sum = 0 %>

<%=define_grid(@tasks_grid, hide_submit_button: true, hide_csv_button: false, hide_reset_button: true ,:show_filters => :always,html: {class: 'my-grid'}, header_tr_html:  {class: 'my-header'}) do |g|
 
  g.column name:  'ID',attribute: 'id', detach_with_id: :id_filter
  

  g.column name: 'Amount' , attribute: 'amount' ,detach_with_id: :amount_filter do |invoice_payment|
    sum = sum +invoice_payment.amount
    '%.2f' % invoice_payment.amount
  end
  
  g.column name: 'Fee' do |invoice_payment|
   invoice_payment.transaction_fee
  end
  
  g.column name: 'Net Payment' do |invoice_payment|
  invoice_payment.net_payment
  end
      
  g.column name: 'Date of Payment', attribute: 'payment_date',detach_with_id: :paymentdate_filter do |invoice_payment|
    invoice_payment.payment_date.to_s(:db)
  end

  g.column name: 'Invoice Number',attribute: 'invoice_id' , in_csv: false,detach_with_id: :invoicenumber_filter do |invoice_payment|
   link_to  invoice_payment.invoice.number,invoice_payment.invoice
  end
  
  g.column name: 'Invoice Number',attribute: 'invoice_id',in_html: false,detach_with_id: :invoicenumber_filter do |invoice_payment|
   invoice_payment.invoice.number
  end    
      
  g.column name: 'Description', attribute: 'description',detach_with_id: :Description_filter
 
     
  g.column name: 'Author', attribute: 'author_id' , in_csv: false , custom_filter: [:author, :to_option] ,detach_with_id: :author_filter do |invoice_payment|
  invoice_payment.author && link_to_user(invoice_payment.author)
  end
  
   g.column name: 'Author', attribute: 'author_id' , in_html: false, custom_filter: [:author, :to_option] ,detach_with_id: :author_filter do |invoice_payment|
   invoice_payment.author
  end

  g.column name: 'Client', attribute: 'contact_id' , :model => 'Invoice' , custom_filter: [:invoice , :to_option] , detach_with_id: :client_filter do |invoice_payment|
  invoice_payment.invoice.contact
  end

  g.column name: 'Created At',attribute: 'created_at',detach_with_id: :createdAt_filter do |invoice_payment|
    invoice_payment.created_at.to_s(:db)
  end
  
  g.column name: 'Updated At',attribute: 'updated_at',detach_with_id: :updatedAt_filter do |invoice_payment|
    invoice_payment.updated_at.to_s(:db)
  end
  
  g.last_row do |number_of_columns|
      "<tr><td><b>Total Amount</b></td><td><b>#{'%.2f' % sum}</b></td></tr>"
  end 
end -%>
